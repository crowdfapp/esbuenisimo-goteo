var animationEnd="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";function whichTransitionEvent(){var e,o=document.createElement("fakeelement"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in t)if(void 0!==o.style[e])return t[e]}$.fn.extend({animateCss:function(e,o){return this.off(),this.addClass("animated "+e).on(animationEnd,function(){$(this).removeClass("animated "+e),$.isFunction(o)&&o.call(this),$(this).off()}),this}});var transitionEnd=whichTransitionEvent();$(function(){$(window);var e=$("body"),i=$("#sidebar-menu"),o=$("#sidebar-menu .sidebar-wrap"),t=$("#sidebar-menu-toggle");$("#main"),$("#footer");setTimeout(function(){e.addClass("loaded")},500);var a=function(){return"absolute"===i.css("position")||"fixed"===i.css("position")},r=function(){e.hasClass("has-sidebar")&&(e.hasClass("sidebar-opened")?(i.animateCss("fadeOut"),t.css("opacity",0),o.animateCss("slideOutLeft",function(){t.css({opacity:1}),e.removeClass("sidebar-opened")})):(e.addClass("sidebar-opened"),i.animateCss("fadeIn"),t.css("opacity",0),o.animateCss("slideInLeft",function(){t.css({opacity:1})})))};if($("body.has-sidebar").on("click",".toggle-sidebar",r),e.hasClass("has-sidebar")){delete Hammer.defaults.cssProps.userSelect;var n=!1;e.on("mouseover",".slider,.material-switch",function(){n=!0}),e.on("mouseout",".slider,.material-switch",function(){n=!1}),e.on("touchstart",".slider,.material-switch",function(e){n=!0}),e.on("touchend",".slider,.material-switch",function(){setTimeout(function(){n=!1})}),e.hammer().bind("swiperight",function(){n||a()&&(e.hasClass("sidebar-opened")||r())}),e.hammer().bind("swipeleft",function(){n||a()&&e.hasClass("sidebar-opened")&&r()}),$("#sidebar-menu .toggle-submenu").on("click",function(e){e.stopPropagation(),e.preventDefault();var o=$(this).closest("li"),t=$(this).next(".submenu"),a=i.find("li.active .submenu").not(t);a.slideUp(function(){a.closest("li.active").removeClass("active")}),o.hasClass("active")?t.slideUp(function(){o.removeClass("active")}):(o.addClass("active"),t.hide().slideDown())}),$("#sidebar-menu li > a[href^='#']:not(.toggle-submenu)").on("click",function(e){r()}),t.affix&&t.affix({offset:{top:parseInt(t.css("top"),10)}})}});var locator={trace:goteo.trace,map:null,autocomplete:null,getUserLocation:function(t){"function"!=typeof t&&(t=function(){}),goteo.user_location?(locator.trace("Location already defined",goteo.user_location),t(goteo.user_location)):locator.setLocationFromFreegeoip("user",null,function(e,o){locator.trace("Location from freegeoip",e),e?(goteo.user_location=e,t(e)):t(null,o)})},saveGeolocationData:function(e,o,t){this.trace("Saving geolocation data, type:",e," item:",o," data:",t),$.post("/json/geolocate/"+e+(o?"/"+o:""),t,function(e){locator.trace("Saved gelocation data result:",e)})},setLocationFromFreegeoip:function(o,t,a){$.getJSON("//freegeoip.net/json/?callback=?",function(e){e.latitude&&e.longitude?(locator.trace("Freegeoip geolocated type:",o," item:",t," data:",e),locator.saveGeolocationData(o,t,{longitude:e.longitude,latitude:e.latitude,city:e.city,region:e.region_name,country:e.country_name,country_code:e.country_code,method:"ip"}),"function"==typeof a&&a(e)):(locator.trace("Freegeoip error"),"function"==typeof a&&a(null,"Freegeoip error"))})},getLocationFromBrowser:function(i,e){var r=!1,n={};if("undefined"==typeof google&&!google.maps)return e||(e=0),e++,this.trace("google.map client does not exists! ["+e+"]"),10<e&&this.trace("Cancelled"),void setTimeout(function(){this.getLocationFromBrowser(i,e)},500);navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){locator.trace("browser info:",e.coords.latitude,e.coords.longitude),n={method:"browser",latitude:e.coords.latitude,longitude:e.coords.longitude},(new google.maps.Geocoder).geocode({latLng:new google.maps.LatLng(e.coords.latitude,e.coords.longitude)},function(e,o){if(o===google.maps.GeocoderStatus.OK)if(e[0]){for(var t in r=!0,e[0].address_components){var a=e[0].address_components[t];"country"===a.types[0]&&"political"===a.types[1]&&(n.country=a.long_name,n.country_code=a.short_name),"locality"===a.types[0]&&"political"===a.types[1]&&(n.city=a.long_name),"administrative_area_level_1"!==a.types[0]&&"administrative_area_level_2"!==a.types[0]||"political"!==a.types[1]||(n.region=a.long_name)}locator.trace("Geocoder data:",n)}else locator.trace("Geocoder failed due to: "+o);"function"==typeof i&&i(r,n)})},function(e){switch(n={locable:1,info:""},e.code){case e.PERMISSION_DENIED:n.locable=0,n.info="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:n.info="Location information is unavailable.";break;case e.TIMEOUT:n.info="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:n.info="An unknown error occurred."}locator.trace("Geocoder error:",e," data:",n),"function"==typeof i&&i(r,n)})},setLocationFromBrowser:function(t,a,i){this.getLocationFromBrowser(function(e,o){locator.trace("Browser geolocation result:",e,o),e?locator.saveGeolocationData(t,a,o):"function"==typeof i&&i(t,a)})},geoCode:function(t,a,i){(new google.maps.Geocoder).geocode(t,function(e,o){o===google.maps.GeocoderStatus.OK?(locator.trace("Got coordinates for",t,e[0].geometry.location),locator.map.setCenter(e[0].geometry.location),locator.marker.setPosition(e[0].geometry.location),locator.map.setZoom(12),a&&a(e[0])):(locator.trace("No address found for",t),i&&i())})},setGoogleMapPoint:function(t,e){if("undefined"==typeof google||!google.maps)return e||(e=0),e++,this.trace("google.maps client does not exists! ["+e+"]"),10<e&&this.trace("Cancelled"),void setTimeout(function(){this.setGoogleMapPoint(t,e)},500);var o=$(t).attr("id");o||(o="map");var a=$(t).data("autocomplete-target"),i=$($(t).data("autocomplete-error")).hide(),r=$($(t).data("autocomplete-success")).hide(),n={center:new google.maps.LatLng(39.5858,2.6411),zoom:5,mapTypeId:google.maps.MapTypeId.ROADMAP};if(this.map=new google.maps.Map(t,n),this.marker=new google.maps.Marker({map:this.map,draggable:!0,animation:google.maps.Animation.DROP}),google.maps.event.addListener(this.marker,"dragstart",function(){locator.trace("drag start"),i.hide(),r.hide()}),google.maps.event.addListener(this.marker,"dragend",function(){locator.trace("dragged marker",locator.marker.getPosition()),locator.geoCode({latLng:locator.marker.getPosition()},function(e){locator.trace("triggering changePlace",a),a&&($(a).val(e.formatted_address),locator.changePlace(a,e),r.show())},function(){i.show()})}),this.markers=[],$(t).is("[data-map-coords]")){var s=$(t).data("map-coords");if($.isArray(s)){var c=new google.maps.LatLngBounds,l=new google.maps.Geocoder;for(var d in s)if(s[d].lat&&s[d].lng){var m=new google.maps.Marker,g=new google.maps.LatLng(s[d].lat,s[d].lng);m.setMap(this.map),m.setPosition(g),c.extend(g),s[d].title&&m.setTitle(s[d].title),this.markers[this.markers.length]=m}else s[d].address&&l.geocode({address:s[d].address},function(e,o){if(o===google.maps.GeocoderStatus.OK){var t=new google.maps.Marker,a=e[0].geometry.location;t.setMap(locator.map),t.setPosition(a),c.extend(a),s[d].title&&t.setTitle(s[d].title),locator.markers[locator.markers.length]=t}});this.map.fitBounds(c)}}if($(t).is("[data-map-content]")){var p=$(t).data("map-content");this.marker=new google.maps.InfoWindow,this.marker.setContent(p),this.marker.setPosition(n.center),this.marker.open(this.map),this.circle||(this.circle=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:this.map,center:n.center,radius:0})),google.maps.event.addListener(this.map,"zoom_changed",function(){locator.marker.setContent(p),locator.marker.open(locator.map)})}var u=parseFloat($(t).data("map-latitude"))||0,f=parseFloat($(t).data("map-longitude"))||0,h=parseInt($(t).data("map-radius"),10)||0,v=$(t).data("map-address");if(u&&f){if(this.trace("Found printable geomap, map_id: ",o," lat,lng: ",u,f," radius;",h," content",$(t).data("map-content")),u&&f){var y=new google.maps.LatLng(u,f);this.marker.setPosition(y),this.map.setCenter(y),this.map.setZoom(12)}}else v&&locator.geoCode({address:v},function(e){u=e.geometry.location.lat(),f=e.geometry.location.lng();var o=locator.getGoogleAddressFromAutocomplete(e);$(t).is("[data-geocoder-type]")&&locator.saveGeolocationData($(t).data("geocoder-type"),$(t).is("[data-geocoder-item]")?$(t).data("geocoder-item"):"",o),locator.trace("triggering changePlace",a),a&&locator.changePlace(a,e)});h&&u&&f&&(this.circle=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:this.map,center:new google.maps.LatLng(u,f),radius:1e3*h}))},getGoogleAddressFromAutocomplete:function(e){if(e){if(this.trace("Geocoder by place, place object:",e),this.trace("place:",e),e&&e.geometry&&e.address_components){var o={latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng(),method:"manual",formatted_address:e.formatted_address};for(var t in e.address_components){var a=e.address_components[t];"country"===a.types[0]&&"political"===a.types[1]&&(o.country=a.long_name,o.country_code=a.short_name),"route"===a.types[0]&&(o.route=a.long_name),"street_number"===a.types[0]&&(o.number=a.long_name),"locality"===a.types[0]&&"political"===a.types[1]&&(o.city=a.long_name),"postal_code"===a.types[0]&&(o.zipcode=a.long_name),"administrative_area_level_1"!==a.types[0]||"political"!==a.types[1]||o.region||(o.region=a.long_name),"administrative_area_level_2"===a.types[0]&&"political"===a.types[1]&&(o.region=a.long_name)}return o.route&&(o.address=o.route),o.number&&o.route&&(o.address=o.route+", "+o.number),this.trace("location data:",o),o}return[]}this.trace("Geocoder error in getGoogleAddressFromplace, place not present")},changePlace:function(e,o){var t=locator.getGoogleAddressFromAutocomplete(o);if(t){locator.trace("Populating new place",o,t),$(e).is("[data-geocoder-type]")&&locator.saveGeolocationData($(e).data("geocoder-type"),$(e).is("[data-geocoder-item]")?$(e).data("geocoder-item"):"",t);var a=["address","city","region","zipcode","country_code","country","latitude","longitude","formatted_address","radius"];if($(e).data("geocoder-skip-population")){var i=$($(e).data("geocoder-populate-latitude")),r=$($(e).data("geocoder-populate-longitude")),n=i.is(":input")?i.val():i.text(),s=r.is(":input")?r.val():r.text();if(n&&s)return void locator.trace("Skipping population. Already populated to",n,s)}for(var c in a){var l=a[c],d=$(e).data("geocoder-populate-"+l);if(locator.trace("populate element",e,d,$(d).val()),d){var m=$(d).text();$(d).is(":input")&&(m=$(d).val()),locator.trace(d+": "+l+"["+t[l]+"] / "+m),t[l]&&($(d).is(":input")?$(d).val(t[l]):$(d).text(t[l]))}}if(locator.map&&locator.marker&&(locator.map.setCenter(o.geometry.location),locator.marker.setPosition(o.geometry.location),locator.circle&&locator.circle.setCenter(o.geometry.location),t.formatted_address))try{locator.marker.setContent(t.formatted_address)}catch(e){}}else locator.trace("No data to populate for place",o)},setGoogleAutocomplete:function(e,o){if("undefined"==typeof google||!google.maps||!google.maps.places)return o||(o=0),o++,this.trace("google.maps.places client does not exists! ["+o+"]"),10<o&&this.trace("Cancelled"),void setTimeout(function(){this.setGoogleAutocomplete(e,o)},500);var t={};$(e).is("[data-geocoder-filter]")&&(t.types=[$(e).data("geocoder-filter")]),this.autocomplete||(this.autocomplete=[]),this.autocomplete[e]||(this.trace("Setting autocomplete for id: ",e," name: ",$(e).attr("name")," element: ",$(e)[0]),this.autocomplete[e]=new google.maps.places.Autocomplete($(e)[0],t),google.maps.event.addListener(this.autocomplete[e],"place_changed",function(){locator.changePlace(e,locator.autocomplete[e].getPlace())}))}};$(function(){locator.getUserLocation(),$(".geo-map").each(function(){locator.setGoogleMapPoint(this)}),$("input.geo-autocomplete").each(function(){$(this).is("[id]")?locator.setGoogleAutocomplete("#"+$(this).attr("id")):locator.trace("Missing ID html element for input:",this),$(this).closest("li.element").bind("superform.dom.done",function(e,o,t){locator.trace("dom update",t),$(t).find("input.geo-autocomplete").each(function(){locator.setGoogleAutocomplete("#"+$(this).attr("id"))})})}),$("input.geo-autocomplete-radius").change(function(){if(locator.map&&locator.circle){locator.circle.setRadius(1e3*$(this).val());var e=$(this).data("geocoder-populate-radius");locator.trace("set radius",e,$(this).val()),e&&$(e).val($(this).val())}})});