$(function(){$(".auto-hide .more").on("click",function(t){t.preventDefault(),$(this).closest(".auto-hide").toggleClass("show")}),$(".auto-update-projects").on("change",".interest",function(t){var e=$(this).is(":checked")?1:0,a=$(this).attr("id"),s=$(this).closest(".auto-update-projects"),n=s.find(".more-projects-button"),i=s.data("url"),o=s.data("limit")||6;$.post(i+"?"+$.param({limit:o}),{id:a,value:e},function(t){t.offset+t.limit>=t.total?n.addClass("hidden"):n.removeClass("hidden"),s.contents(".elements-container").html(t.html)})}),$(".auto-update-projects").on("click",".more-projects-button",function(t){t.preventDefault();var e=$(this).closest(".auto-update-projects"),a=e.find(".more-projects-button"),s=e.find(".widget-element").length,n=e.data("url"),i=(e.data("total"),e.data("limit")||6);$.get(n,{offset:s,limit:i},function(t){t.offset+t.limit>=t.total?a.addClass("hidden"):a.removeClass("hidden"),e.contents(".elements-container").append(t.html)})}),$(".ajax-comments").on("click",".send-comment",function(t){t.preventDefault();var e=$(this).closest(".ajax-comments"),a=$(e.data("list")),s=e.data("url"),n=e.find(".error-message"),i=e.find('[name="message"]'),o=$(".ajax-comments .recipients"),r=[];o.find(".label").each(function(){r.push($(this).data("user"))});var c={message:i.val(),recipients:r,thread:e.data("thread"),project:e.data("project"),admin:e.data("admin"),view:"dashboard"};n.addClass("hidden").html(""),$.post(s,c,function(t){a.append(t.html),i.val(""),o.find(".text").html(o.data("public"))}).fail(function(e){var a;try{a=JSON.parse(e.responseText).error}catch(t){a=e.statusText}n.removeClass("hidden").html(a)})}),$(".comments-list").on("click",".delete-comment",function(t){t.preventDefault();var e=$(this).data("confirm"),a=$(this).data("url"),s=$(this).closest(".comment-item"),n=s.find(".error-message");confirm(e)&&$.ajax({url:a,type:"DELETE",success:function(t){s.remove()}}).fail(function(t){var e=JSON.parse(t.responseText);n.removeClass("hidden").html(e.error)})});var n=function(t,e,a){t.find(".text").html(t.data("private")),t.find('[data-user="'+e+'"]').length||t.append(' <span class="label label-lilac" data-user="'+e+'">'+a+' <i class="fa fa-close"></i></span>')};$(".comments-list").on("click",".send-private",function(t){t.preventDefault();var e=$(this).data("user"),a=$(this).data("name"),s=$(this).closest(".comments").find(".recipients");n(s,e,a)}),$(".ajax-comments .recipients").on("click",".label>i",function(t){var e=$(this).closest(".recipients"),a=$('.ajax-comments input[name="private"]');$(this).parent().remove(),e.find(".label").length||(e.find(".text").html(e.data("public")),a.prop("checked",!1))}),$(".ajax-comments").on("click",'input[name="private"]',function(t){t.preventDefault();var e=$(this).closest(".ajax-comments").find(".recipients"),a=$(this).closest(".comments").find(".comments-list");$(this).prop("checked",!0),a.find(".send-private").each(function(){n(e,$(this).data("user"),$(this).data("name"))})}),$(".ajax-message").on("click",".send-message",function(t){t.preventDefault();var e=$(this).closest(".ajax-message"),a=e.data("url"),s=e.find(".error-message"),n=e.find('[name="subject"]'),i=e.find('[name="body"]'),o=e.find('[name="reward"]'),r=e.find('[name="filter"]'),c=e.find('[name="users"]'),d={subject:n.val(),body:i.val(),thread:e.data("thread"),reward:o.val(),filter:r.val(),users:c.val().split(","),project:e.data("project")};s.addClass("hidden").html(""),$.post(a,d,function(t){$(document).trigger("message-sent",[d,t])}).fail(function(e){var a;try{a=JSON.parse(e.responseText).error}catch(t){a=e.statusText}s.removeClass("hidden").html(a)})})});